<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>D√©couverte de Docker üê≥</title>
    <base target="_blank" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reset.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/theme/white.min.css"
      id="theme"
    />
    <!-- Theme used for syntax highlighted code -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/monokai.min.css"
      id="highlight-theme"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/asciinema-player.css"
    />
    <style>
      .vertical-center {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* Double colonnes */
      .container-flex {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-content: flex-start;
        align-items: center;
      }

      /* Placer des petites images √† c√¥t√© du texte */
      .wrapper-icon .icon {
        position: relative;
        margin: 0 10px 0 0;
        width: 25px;
        height: 25px;
      }

      .col-1 {
        flex: 1;
      }

      .col-2 {
        flex: 2;
      }

      .col-3 {
        flex: 3;
      }

      .asciinema-theme-monokai .asciinema-terminal {
        margin-top: 0px;
      }

      .reveal pre code {
        font-size: 0.55em;
        line-height: 1.3em;
        margin-top: 0px;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <!-- Page de garde -->
        <section>
          <img width="40%" src="/images/baleinebleue.png" />

          <h3><s>Adopter une baleine bleue</s></h3>
          <h4>D√©couverte de Docker</h4>
          <p>Micka√´l BARON - Version 04-2023</p>
          <p>
            <a href="mailto:baron.mickael@gmail.com">baron.mickael@gmail.com</a>
            ou <a href="mailto:baron@ensma.fr">baron@ensma.fr</a>
          </p>
          <div class="wrapper-icon">
            <a target="_blank" href="https://github.com/mickaelbaron"
              ><img
                class="icon"
                src="/images/slides/github.svg"
              />mickaelbaron</a
            >
            <a target="_blank" href="https://mickael-baron.fr"
              ><img
                class="icon"
                src="/images/slides/web.svg"
              />mickael-baron.fr</a
            >
          </div>
        </section>

        <!-- Licence d'utilisation -->
        <section>
          <section>
            <h3>Licence d'utilisation</h3>

            <p><b>Creative Commons</b></p>
            <p>Contrat Paternit√©</p>
            <p>Partage des Conditions Initiales √† l'Identique</p>
            <p>2.0 France</p>
            <p><img width="50%" src="/images/slides/by-sa.svg" /></p>
            <a
              target="_blank"
              href="https://creativecommons.org/licenses/by-sa/4.0/"
              >creativecommons.org/licenses/by-sa/4.0</a
            >
          </section>
          <section>
            <div class="vertical-center">
              <a href="https://www.buymeacoffee.com/mickaelbaron" target="_blank">
                <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 120px !important; width: 434px !important"/>
              </a>
            </div>
          </section>
        </section>

        <!-- Qui suis-je ? -->
        <section>
          <section>
            <h3>Qui suis-je ?</h3>

            <img
              width="25%"
              class="roundedImage"
              src="/images/slides/mbaron.jpg"
            />
            <div class="wrapper-icon">
              <p>
              </p>
              <p>
                <a target="_blank" href="https://mickael-baron.fr"
                  ><img
                    class="icon"
                    src="/images/slides/web.svg"
                  />mickael-baron.fr</a
                >
              </p>
              <p>
                <a target="_blank" href="https://github.com/mickaelbaron"
                  ><img
                    class="icon"
                    src="/images/slides/github.svg"
                  />mickaelbaron</a
                >
              </p>
            </div>
          </section>
          <section>
            <h3>Ing√©nieur de Recherche ‚òÄÔ∏è</h3>

            <div class="container-flex">
              <div class="col-1" style="text-align: left">
                <ul style="line-height: 200%">
                  <li>
                    Recherche dans l'√©quipe <b>I</b>ng√©nierie des <b>D</b>onn√©es
                    et des mo<b>D</b>√®les (IDD)
                  </li>
                  <li>Valorisation des plateformes logicielles</li>
                  <li>¬´¬†Coach technique¬†¬ª aupr√®s des usag√©s</li>
                </ul>
              </div>
              <div class="col-1">
                <img width="65%" src="/images/slides/isae_ensma.svg" />
                <img width="65%" src="/images/slides/lias.png" />
                <div class="wrapper-icon">
                  <p>
                    <a target="_blank" href="https://github.com/lias-laboratory"
                      ><img
                        class="icon"
                        src="/images/slides/github.svg"
                      />lias-laboratory</a
                    >
                  </p>
                  <p>
                    <a target="_blank" href="https://www.lias-lab.fr"
                      ><img
                        class="icon"
                        src="/images/slides/web.svg"
                      />www.lias-lab.fr</a
                    >
                  </p>
                </div>
              </div>
            </div>
          </section>
          <section>
            <h3>Ancien Responsable üåë (2011-2021)</h3>

            <div class="container-flex">
              <div class="col-1">
                <img width="100%" src="/images/slides/developpezcom.png" />
                <div class="wrapper-icon">
                  <p>
                    <a href="https://twitter.com/Developpez"
                      ><img
                        class="icon"
                        src="/images/slides/twitter.svg"
                      />@Developpez</a
                    >
                  </p>
                  <p>
                    <a href="https://java.developpez.com"
                      ><img
                        class="icon"
                        src="/images/slides/web.svg"
                      />java.developpez.com</a
                    >
                  </p>
                </div>
              </div>
              <div class="col-1" style="text-align: left">
                <ul style="line-height: 150%">
                  <li>
                    Rubriques : Java, Java Web, Android, Eclipse, Spring et
                    Netbeans
                  </li>
                  <li>R√©dacteurs de tutoriels</li>
                  <li>Chiffres</li>
                  <ul>
                    <li>4 M de visiteurs</li>
                    <li>12 M pages vues/mois</li>
                    <li>7500 membres</li>
                    <li>2000 forums</li>
                  </ul>
                </ul>
              </div>
            </div>
          </section>
        </section>
        <section>
          <section>
            <h3>Disclaimer üßéüèª‚Äç‚ôÇÔ∏è</h3>
            <div style="text-align: left">
              <p>De nombreux <u>raccourcis</u> ont √©t√© utilis√©s</p>
              <p>Niveau : d√©butant (savoir cr√©er une machine virtuelle)</p>
              <p>
                Pr√©sentation rapide de
                <a href="https://www.docker.com/">Docker</a> (format ~ 60 min)
              </p>
              <ul style="line-height: 200%">
                <li>
                  Focaliser sur <b>pourquoi</b>
                  <a href="https://www.docker.com/">Docker</a> est utile
                </li>
                <li>Se limiter aux principaux concepts</li>
                <li>
                  Illustrer par des d√©monstrations en live (<a
                    href="https://asciinema.org/"
                    >Asciinema</a
                  >)
                </li>
              </ul>
            </div>
          </section>
          <section>
            <h3>Dans la m√™me s√©rie ... avec Docker</h3>
            <ul style="line-height: 150%">
              <li>
                <a
                  href="https://mickael-baron.fr/soa/microservices-mise-en-oeuvre"
                  >Mise en ≈ìuvre d'architectures microservices avec Java et
                  Docker (support de cours)</a
                >
              </li>
              <li>
                <a
                  href="https://github.com/mickaelbaron/javamicroservices-tutorial"
                  >Microservices avec Docker - D√©veloppement avec le langage
                  Java (tutoriel)</a
                >
              </li>
              <li>
                <a
                  href="https://mickael-baron.fr/soa/microservices-mise-en-oeuvre-kubernetes"
                  >Mise en ≈ìuvre d'architectures microservices avec Kubernetes
                  (support de cours)</a
                >
              </li>
              <li>
                <a
                  href="https://github.com/mickaelbaron/microservices-kubernetes-gettingstarted-tutorial"
                  >Microservices avec Kubernetes - Les bases de K8s
                  (tutoriel)</a
                >
              </li>
            </ul>
          </section>
        </section>
        <section
          data-background-size="55%"
          data-background-opacity="0.2"
          data-background-image="images/plan.png"
        >
          <h3>Objectif du support de cours</h3>

          <ul style="line-height: 175%">
            <li>Pourquoi ?</li>
            <li>G√©n√©ralit√©s</li>
            <li>Image</li>
            <li>Conteneur</li>
            <li>Construction d'une image</li>
            <li>Gestion des donn√©es</li>
            <li>Redirection des ports</li>
          </ul>
        </section>
        <section>
          <section>
            <h3>Contexte : besoin d'isoler ...</h3>
            <div style="text-align: left">
              <p>Ex√©cuter une application sur un <b>OS non support√©</b></p>
              <ul>
                <li>Ex : ROS qui ne fonctionne que sous Ubuntu 16.04</li>
              </ul>
              <p><b>Multiplier les instances</b> d‚Äôune m√™me application</p>
              <ul>
                <li>Ex : monter en charge une application web</li>
              </ul>
              <p>Ex√©cuter une application en mode <b>¬´ bac √† sable ¬ª</b></p>
              <ul>
                <li>Ex : tester un prototype de recherche</li>
              </ul>
              <p>Reproduire son <b>environnement de production</b></p>
              <ul>
                <li>Ex : PHP, MySQL, compilateur, Latex</li>
              </ul>
            </div>
          </section>
          <section>
            <h3>Comment isoler ?</h3>
            <p>Pour isoler une application => trois techniques</p>
            <div class="container-flex">
              <div class="col-1">
                <p><b>Physique</b></p>
                <img width="85%" src="images/physicalmachine.png" />
              </div>
              <div class="col-1">
                <p><b>Virtualisation</b></p>
                <img width="85%" src="images/virtualmachine.png" />
              </div>
              <div class="col-1">
                <p><b>Conteneur</b></p>
                <img width="85%" src="images/container.png" />
              </div>
            </div>
          </section>
          <section>
            <h3>Virtualisation VS Conteneur</h3>
            <p>Comparatif sur les performances (valeurs approx.)</p>
            <div style="font-size: 45px">
              <table
                style="border-collapse: separate; border-spacing: 0px 30px"
              >
                <thead>
                  <tr>
                    <th></th>
                    <th>Virtualisation</th>
                    <th>Conteneur</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b>D√©marrage</b></td>
                    <td>2 min.</td>
                    <td>0.2 sec</td>
                  </tr>
                  <tr>
                    <td><b>M√©moire</b></td>
                    <td>256 Mo min.</td>
                    <td>0.3 Mo</td>
                  </tr>
                  <tr>
                    <td><b>Espace Disque</b></td>
                    <td>1 Go min.</td>
                    <td>0.1 Mo</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>
        <section>
          <section
            data-background-size="50%"
            data-background-opacity="0.1"
            data-background-image="images/dockerlogo.png"
          >
            <h3>G√©n√©ralit√©s Commerciales</h3>
            <div style="text-align: left">
              <p>Docker Inc. est une entreprise fond√©e en mars 2013</p>
              <p>Sites web officiels</p>
              <ul>
                <li>
                  Site de r√©f√©rence :
                  <a href="https://www.docker.com">www.docker.com</a>
                </li>
                <li>
                  Documentation :
                  <a href="https://docs.docker.com">docs.docker.com</a>
                </li>
                <li>
                  Installation :
                  <a href="https://docs.docker.com/engine/install"
                    >docs.docker.com/engine/install</a
                  >
                </li>
                <li>
                  Twitter :
                  <a href="https://twitter.com/Docker">twitter.com/Docker</a>
                </li>
                <li>
                  Blog :
                  <a href="https://www.docker.com/blog">www.docker.com/blog</a>
                </li>
              </ul>
              <p>Propose des outils du m√™me nom que la soci√©t√©</p>
            </div>
          </section>
          <section
            data-background-size="60%"
            data-background-opacity="0.1"
            data-background-image="images/dockerlinux.png"
          >
            <h3>G√©n√©ralit√©s Techniques</h3>
            <div style="text-align: left">
              <p>Bas√© sur le principe des conteneurs</p>
              <ul>
                <li>
                  <a href="https://en.wikipedia.org/wiki/LXC"
                    >LinuX Containers (LXC)</a
                  >
                  : isolation ex√©cution
                </li>
                <li>
                  <a href="https://en.wikipedia.org/wiki/Cgroups">cgroups</a> :
                  isolation au niv. noyau Linux
                </li>
                <li>
                  <a href="https://en.wikipedia.org/wiki/Union_mount"
                    >Union Mounting</a
                  >
                  : point de montage
                </li>
              </ul>
              <p>Outils principalement en ligne de commande (CLI)</p>
              <p>Fonctionne nativement sous Linux</p>
              <p>
                Sous Windows et macOS n√©cessite une machine virtuelle Linux (<a
                  href="https://www.docker.com/products/docker-desktop"
                  >DockerDesktop</a
                >)
              </p>
            </div>
          </section>
          <section>
            <h3>Docker : un // avec Java ‚ù§Ô∏è</h3>
            <img width="80%" src="images/dockervsjava.png" />
          </section>
        </section>
        <section>
          <section>
            <h3>Images</h3>
            <div style="text-align: left">
              <p>Dans un syst√®me Linux, <b>deux syst√®mes de fichiers</b></p>
              <ul>
                <li>
                  <em>bootfs</em> : contient le noyau du syst√®me h√¥te
                </li>
                <li><em>rootfs</em> : contient la structure des r√©pertoires</li>
              </ul>
            </div>
            <img width="70%" src="images/images1.png" />
          </section>
          <section>
            <h3>Images</h3>
            <div style="text-align: left">
              <p>Plusieurs <em>rootfs</em> ?</p>
              <ul style="line-height: 200%">
                <li>Sous un syst√®me Linux classique un seul <em>rootfs</em></li>
                <li>
                  Sous <a href="https://www.docker.com/">Docker</a> possibilit√©
                  de <b>plusieurs <em>rootfs</em></b>
                </li>
              </ul>
            </div>
            <img width="45%" src="images/images2.png" />
          </section>
          <section>
            <h3>Images</h3>
            <div style="text-align: left">
              <p>
                Le <em>rootfs</em> constitue l‚Äô<em>image de base</em> d‚Äôun
                conteneur
              </p>
              <p>Une image ne peut √™tre modifi√©e car en <b>lecture seule</b></p>
            </div>
            <img width="75%" src="images/images3.png" />
          </section>
          <section>
            <h3>Images</h3>
            <div style="text-align: left">
              <p>Une image est compos√©e de couches appel√©es <em>layer</em></p>
              <p>
                Une couche est li√©e √† la couche inf√©rieure dite <em>parente</em>
              </p>
              <p>Toutes les couches forme l'<em>image finale</em></p>
            </div>
            <div class="container-flex">
              <div class="col-2">
                <ul style="line-height: 200%">
                  <li>Image finale = Deb emacs Apache</li>
                  <li>Image de base = Debian</li>
                  <li>Deuxi√®me couche = Emacs</li>
                  <li>Couche parente Apache = Emacs</li>
                </ul>
              </div>
              <div class="col-1">
                <img width="100%" src="images/images4.png" />
              </div>
            </div>
          </section>
          <section>
            <h3>Images</h3>
            <div style="text-align: left">
              <p>
                Une <em>image finale</em> peut √™tre r√©utilis√©e pour construire
                de nouvelles images
              </p>
              <p>O√π trouver des images ?</p>
              <ul style="line-height: 175%">
                <li>
                  Registre public d'images :
                  <a href="https://hub.docker.com/">hub.docker.com</a>
                </li>
                <li>Possibilit√© de cr√©er son <b>registre priv√© d'images</b></li>
              </ul>
            </div>
            <img width="50%" src="images/dockerhub.png" />
          </section>
        </section>
        <section>
          <section>
            <h3>Conteneur</h3>
            <div style="text-align: left">
              <p>
                Un <em>conteneur</em> est une <b>couche modifiable</b> li√©e √† la
                couche inf√©rieure
              </p>
              <p>Seul le conteneur est en <b>lecture et √©criture</b></p>
              <p>Comparaison avec le monde Java</p>
            </div>
            <div class="container-flex">
              <div class="col-2">
                <ul style="line-height: 145%">
                  <li>bootfs = JVM</li>
                  <li>Image de base = classe Object</li>
                  <li>Image = classe</li>
                  <li>Relation parent = h√©ritage</li>
                  <li>Conteneur = instance d'une classe</li>
                </ul>
              </div>
              <div class="col-1">
                <img width="100%" src="images/dockercontainer.png" />
              </div>
            </div>
          </section>
          <section>
            <h3>Conteneur interactif (d√©mo1)</h3>
            <p>Commandes : <b>pull, run et ps</b></p>
            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim># T√©l√©charge l&prime;image busybox depuis DockerHub
$ docker pull busybox
Using default tag: latest
latest: Pulling from library/busybox
						
c00ef186408b: Pull complete
ac6a7980c6c2: Pull complete
Digest: sha256:e4f93f6ed15a0cdd342f5aae387886fba0ab98af0a102da6276eaf24d6e6ade0
Status: Downloaded newer image for busybox:latest
						
# Cr√©ation d&prime;un conteneur
$ docker run -it busybox /bin/sh # -i = interactif ‚Äìt = dans la console en cours

# Liste le contenu du rootfs du conteneur
$ üê≥ ls
bin   dev   etc   home  proc  root  sys   tmp   usr   var

# Liste les processus du conteneur
$ üê≥ ps -ef

# Fermeture du conteneur (le conteneur se termine)
$ üê≥ exit

# Affichage des conteneurs (en cours, arr√™t√©s, stopp√©s...)
$ docker ps ‚Äìa
CONTAINER ID   IMAGE     COMMAND     CREATED          STATUS                     PORTS   NAMES
d2bc3ccd2ee1   busybox   "/bin/sh"   26 minutes ago   Exited (0) 23 minutes ago          goofy_bhabha</code></pre>
          </section>
          <section>
            <h3>Conteneur interactif (d√©mo1)</h3>
            <p>Commandes : <b>pull, run et ps</b></p>
            <div id="demo1"></div>
          </section>
          <section>
            <h3>Conteneur d√©tach√© (d√©mo2)</h3>
            <p>Commandes Docker : <b>run, logs, ps, attach</b></p>
            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim># D√©marre un processus tr√®s long
$ JOB=$(docker run -d busybox /bin/sh -c 'while true; do echo Hello LIAS $(date); sleep 1; done')
						
# Affichage des informations
$ docker logs $JOB
...
Hello LIAS Thu Jan 7 15:09:01 UTC 2016
Hello LIAS Thu Jan 7 15:09:02 UTC 2016
						
# V√©rification de l&prime;√©tat d&prime;ex√©cution
$ docker ps
CONTAINER ID  IMAGE    COMMAND              CREATED        STATUS         PORTS   NAMES
01d4dacd55e2  busybox  "/bin/sh -c 'while"  1 minutes ago  Up 25 seconds          reverent_franklin
						
# Attacher un conteneur
$ docker attach $JOB
...
Hello LIAS Thu Jan 7 15:17:22 UTC 2016
Hello LIAS Thu Jan 7 15:17:23 UTC 2016 # Pour terminer un CTRL-C
						
# V√©rification de l&prime;√©tat d&prime;ex√©cution
$ docker ps -a
CONTAINER ID  IMAGE    COMMAND              CREATED        STATUS           PORTS  NAMES
01d4dacd55e2  busybox  "/bin/sh -c 'while"  9 minutes ago  Exited (0) 44 s         reverent_franklin
						
# Suppression d&prime;un conteneur
$ docker rm $JOB # Un conteneur doit √™tre arr√™t√© pour le supprimer ou forcer par l‚Äôoption -f</code></pre>
          </section>
          <section>
            <h3>Conteneur d√©tach√© (d√©mo2)</h3>
            <p>Commandes : <b>run, logs, ps, attach</b></p>
            <div id="demo2"></div>
          </section>
          <section>
            <h3>Conteneur sans √©tat (d√©mo3)</h3>
            <p>Commandes : <b>run, exec, diff, rm</b></p>
            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim># Cr√©ation de fichiers dans le r√©pertoire /tmp
$ JOB=$(docker run -d busybox /bin/sh -c 'while true ; do /bin/touch /tmp/$(date +%H%M%S); sleep 3; done')

# Liste le contenu du r√©pertoire /tmp
$ docker exec $JOB /bin/ls /tmp
072208
072211

# Changement sur le syst√®me de fichier ‚Äì C = Changement, A = Ajout, D = Delete
$ docker diff $JOB
C /tmp
A /tmp/072208
A /tmp/072211

# Suppression du conteneur
$ docker rm -f $JOB
01dbf7a101abc13a80a95fae41c78a3997de90fa9636c26a4c6498738c631c26

# Si nouveau conteneur les anciens fichiers ne sont plus l√†
$ docker run -it busybox /bin/ls /tmp

# N&prime;avez-vous jamais voulu faire cela ? ‚Äòrm ‚Äìrf /usr‚Äô 
$ docker run -it busybox /bin/sh -c '/bin/rm -rf /usr;/bin/ls /'</code></pre>
          </section>
          <section>
            <h3>Conteneur sans √©tat (d√©mo3)</h3>
            <p>Commandes : <b>run, exec, diff, rm</b></p>
            <div id="demo3"></div>
          </section>
        </section>
        <section>
          <section>
            <h3>Cr√©er une image</h3>
            <div style="text-align: left">
              <p>
                √Ä la cr√©ation d‚Äôun conteneur, le syst√®me de fichiers correspond
                √† celui de l‚Äôimage <em>parente</em>
              </p>
              <p>
                Lors de l‚Äô<b>arr√™t du conteneur</b> les modifications sont
                <b>perdues</b>
              </p>
              <p>J'aimerais pouvoir conserver ce qui suit ?</p>
              <ul style="line-height: 145%">
                <li>Installations de programmes</li>
                <li>Organisation de r√©pertoires</li>
                <li>Configuration (r√©seaux, programmes...)</li>
              </ul>
              <p>Solution ‚û°Ô∏è cr√©er une nouvelle image</p>
            </div>
          </section>
          <section>
            <h3>Cr√©er une image</h3>
            <div style="text-align: left">
              <p>
                Pour cr√©er une nouvelle image
                <a href="https://www.docker.com/">Docker</a> dans votre d√©p√¥t
                local
              </p>
              <ul>
                <li>commande <em>commit</em></li>
                <li>utilisation d'un fichier <em>Dockerfile</em></li>
              </ul>
              <p>Commande <em>commit</em></p>
              <ul>
                <li>Passage d'un conteneur en image</li>
                <li>Conteneur √† l'arr√™t ou en ex√©cution</li>
              </ul>
              <p>Fichier <em>Dockerfile</em> (d√©taill√© par le suite)</p>
            </div>
          </section>
          <section>
            <h3>Cr√©er une image (cas d'√©tude r√©el)</h3>
            <div style="text-align: left">
              <p>
                Cas d'√©tude :
                <a href="https://github.com/gh-rdf3x/gh-rdf3x">rdf3x</a>
              </p>
              <ul>
                <li>Moteur de stockage de donn√©es RDF</li>
                <li>Interpr√©teur SPARQL (en ligne de commande)</li>
              </ul>
              <p>
                Limitations de la version actuelle
                <a href="https://github.com/gh-rdf3x/gh-rdf3x">rdf3x</a>
              </p>
              <ul>
                <li>Ne compile (C++) que sous Linux (Ubuntu 16.04)</li>
                <li>Pas de SPARQL Endpoint (interface web)</li>
              </ul>
              <p>Objectifs ‚û°Ô∏è configurer son poste de d√©veloppeur</p>
              <ul>
                <li>
                  Proposer une image Docker de
                  <a href="https://github.com/gh-rdf3x/gh-rdf3x">rdf3x</a>
                </li>
                <li>Importer des donn√©es et ex√©cuter des requ√™tes</li>
              </ul>
            </div>
          </section>
          <section>
            <h3>Cr√©er image via commit (d√©mo4)</h3>
            <p>Commandes : <b>run, exec, diff, rm</b></p>
            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim># Cr√©er un conteneur √† partir d‚Äôune image de base
$ docker run ‚Äìit --name gh_rdf3x ubuntu:16.04 /bin/sh

# Ex√©cuter les commandes
$ üê≥ apt-get update -y && apt-get install -y git g++ make
...
$ üê≥ git clone https://github.com/gh-rdf3x/gh-rdf3x && cd gh-rdf3x && make
...

# S‚Äòassurer que la compilation s‚Äòest bien d√©roul√©e
$ üê≥ ls /gh-rdf3x/bin
buildmonetdb  buildpostgresql  cts  infra  makeutil  rdf3xdump	rdf3xembedded  rdf3xload  rdf3xquery
rdf3xreorg  rdf3xupdate  rts  tools  translatesparql

# Cr√©ation d‚Äôune image appel√©e mickaelbaron/gh_rdf3x_manual
$ docker commit gh_rdf3x mickaelbaron/gh_rdf3x_manual
C40410395aedf8cfb8f55469a974a519ee764dd3a765e3c78df8df60316870ad # => Id de l‚Äôimage

# Suppression du conteneur actuel
$ docker rm -f gh_rdf3x
gh_rdf3x

# Affiche la liste des images en cache
docker images
REPOSITORY           	        TAG        IMAGE ID        CREATED              VIRTUAL SIZE
mickaelbaron/gh_rdf3x_manual  latest     c40410395aed    About a minute ago   533 MB
Ubuntu                        latest     ac6a7980c6c2    5 weeks ago          123 MB

# Cr√©ation d‚Äôun conteneur √† partir de la nouvelle image
$ docker run ‚Äìit --name gh_rdf3x mickaelbaron/gh_rdf3x_manual /bin/sh</code></pre>
          </section>
          <section>
            <h3>Cr√©er image via commit (d√©mo4)</h3>
            <p>Commandes : <b>run, exec, diff, rm</b></p>
            <div id="demo4"></div>
          </section>
          <section>
            <h3>Cr√©er image via Dockerfile</h3>
            <div style="text-align: left">
              <p>Un fichier <em>Dockerfile</em> pour cr√©er des images</p>
              <ul>
                <li>Provisionner (installer des apps, copier des fichiers)</li>
                <li>Configuration (port, t√¢che de fond)</li>
              </ul>
              <p>Format du fichier</p>
              <ul>
                <li># pour les commentaires</li>
                <li>INSTRUCTION arguments</li>
              </ul>
              <p>
                <b>Chaque instruction</b> est ex√©cut√©e <b>ind√©pendament</b> et
                suivie par un <b>commit</b> ‚û°Ô∏è image √† chaque instruction
              </p>
            </div>
          </section>
          <section>
            <h3>Cr√©er image via Dockerfile (d√©mo5)</h3>
            <div style="text-align: left">
              <p>Pr√©paration √† la construction d‚Äôune image RDF-3X</p>
              <pre><code class="language-shell" style="max-height: 500px;font-size: 1em;" data-noescape data-trim># Indique l&prime;image de base
FROM ubuntu:16.04
LABEL maintener="Mickael BARON"

# Ex√©cute des commandes dans une couche
RUN apt-get update -y && \ 
	apt-get install -y git g++ make
 
# Ex√©cute de nouvelles commandes dans une autre couche
RUN git clone https://github.com/gh-rdf3x/gh-rdf3x && \
	cd gh-rdf3x && \
	make

# Pr√©cise le r√©pertoire courant √† la cr√©ation du conteneur
WORKDIR /output</code></pre>
            </div>
          </section>
          <section>
            <h3>Cr√©er image via Dockerfile (d√©mo5)</h3>
            <div id="demo5"></div>
          </section>
        </section>
        <section>
          <section>
            <h3>Persister les donn√©es avec les volumes</h3>
            <div style="text-align: left">
              <p>
                Un conteneur est volatile : les donn√©es produites sont perdues
                lors de la destruction du conteneur
              </p>
              <p>
                Comment s‚Äôassurer que si je recr√©e mon conteneur je retrouverai
                mes donn√©es ? ‚û°Ô∏è utilisation des Volumes
              </p>
              <p>
                Dossier qui se trouve √† la fois sur le h√¥te et sur le conteneur
                (comme un dossier partag√©)
              </p>
              <p>
                Pour cr√©er un volume, utilisation du param√®tre <em>-v</em> lors
                de la cr√©ation d‚Äôun conteneur
              </p>
            </div>
          </section>
          <section>
            <h3>Les volumes (d√©mo6)</h3>
            <p>Commande : <b>run</b></p>

            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim>$ ls "$PWD"/data
lubm-data.nt query.sparql

# Cr√©ation d&prime;une base RDF-3X via un conteneur Docker
# Volume o√π seront stock√©s les donn√©es d‚Äôentr√©es .nt et requ√™tes SPARQL
# -v "$PWD"/data:/data : associe "$PWD"/data du h√¥te au r√©pertoire /data du conteneur
# Volume o√π seront stock√©s les bases RDF-3X
# -v "$PWD"/output:/output : associe "$PWD"/output du h√¥te au r√©pertoire /output du conteneur 
$ docker run --rm -v "$PWD"/data:/data -v "$PWD"/output:/output mickaelbaron/gh_rdf3x 
           /gh-rdf3x/bin/rdf3xload /output/datadb /data/lubm-data.nt

$ ls "$PWD"/output
datadb

# Ex√©cution d&prime;une requ√™te SPARQL √† partir d&prime;une base RDF-3X cr√©√©e pr√©c√©demment
$ docker run --rm -v "$PWD"/data:/data -v "$PWD"/output:/output mickaelbaron/gh_rdf3x 
           /gh-rdf3x/bin/rdf3xquery /output/datadb /data/query.sparql
RDF-3X query interface
(c) 2008 Thomas Neumann. Web site: http://www.mpi-inf.mpg.de/~neumann/rdf3x
(c) 2013 Hancel Gonzalez and Giuseppe De Simone. Web site: http://github.com/gh-rdf3x/gh-rdf3x
&lt;http://www.w3.org/2002/07/owl#Ontology&gt; 190
&lt;http://www.w3.org/2002/07/owl#Class&gt; 43
&lt;http://swat.cse.lehigh.edu/onto/univ-bench.owl#Publication&gt; 76529
&lt;http://swat.cse.lehigh.edu/onto/univ-bench.owl#AssistantProfessor&gt; 1822
&lt;http://swat.cse.lehigh.edu/onto/univ-bench.owl#AssociateProfessor&gt; 2291
&lt;http://www.w3.org/2002/07/owl#Restriction&gt; 8
...    

</code></pre>
          </section>
          <section>
            <h3>Les volumes (d√©mo6)</h3>
            <p>Commande : <b>run</b></p>
            <div id="demo6"></div>
          </section>
        </section>
        <section>
          <section>
            <h3>Rediriger les ports</h3>
            <div style="text-align: left">
              <p>
                Lors de la cr√©ation d‚Äôun conteneur, une adresse IP lui est
                assign√©e dans un sous-r√©seau
                <a href="https://www.docker.com/">Docker</a>
              </p>
              <p>Pour acc√©der √† un port particulier du conteneur</p>
              <ul>
                <li>en passant par l‚Äôadresse IP du conteneur:PORT</li>
                <li>en passant par la redirection de port</li>
              </ul>
              <p>
                La redirection de port permet d‚Äôacc√©der au conteneur en
                utilisant l‚Äôacc√®s r√©seau du syst√®me h√¥te
              </p>
              <p>
                Pour rediriger un port r√©seau utilisation du param√®tre
                <em>-p portHote:portConteneur</em>
              </p>
            </div>
          </section>
          <section>
            <h3>Rediriger les ports (d√©mo7)</h3>
            <p>Commande : <b>run</b></p>
            <pre><code class="language-shell" style="max-height: 500px;" data-noescape data-trim># Cr√©er un conteneur Postgres avec une redirection du port 5432 vers le 54320 de l‚Äôh√¥te
$ docker run --name postgres54320 -p 54320:5432 -d postgres
efee2388c2e8ed3c8b135731159a809a88f0681385a4ff70c145a0e690a2d57e

# Utilisation de l‚Äôoutil psql install√© depuis l‚Äôh√¥te
$ psql -U postgres -d postgres -h localhost -p 54320
psql (9.4.4, server 10.0)
WARNING: psql major version 9.4, server major version 10.0.
         Some psql features might not work.
Type "help" for help.

postgres=# select 1;
 ?column?
----------
        1
(1 row)

postgres=#

# Cr√©er un deuxi√®me conteneur Postgres avec une redirection du port 5432 vers le 54321 de l‚Äôh√¥te
$ docker run --name postgres54321 -p 54321:5432 -d postgres
77457b4a34d35409e556cf1c1b8366cf8e5624874b674e418119bfe57f93b5a7

# Utilisation de l‚Äôoutil psql depuis l‚Äôh√¥te
$ psql -U postgres -d postgres -h localhost -p 54321
...</code></pre>
          </section>
          <section>
            <h3>Rediriger les ports (d√©mo7)</h3>
            <p>Commande : <b>run</b></p>
            <div id="demo7"></div>
          </section>
        </section>
        <section>
          <h3>Aller plus loin</h3>
          <div style="text-align: left">
            <p>
              Pr√©sentation rapide de
              <a href="https://www.docker.com/">Docker</a> et de ses commandes
            </p>
            <p><b>√Ä approfondir</b></p>
            <ul>
              <li>Images plus l√©g√®res (multi-stage)</li>
              <li>Sous-r√©seaux</li>
              <li>D√©port d‚Äôaffichage avec X11</li>
              <li>Tests unitaires (e.g. <a target="_blank" href="https://github.com/GoogleContainerTools/container-structure-test">container-structure-test</a>)</li>
            </ul>
            <p><b>√Ä d√©couvrir</b></p>
            <ul>
              <li>Composition de conteneurs avec <b>Docker Compose</b></li>
              <li>
                Orchestration de conteneurs avec
                <a
                  href="https://mickael-baron.fr/soa/microservices-mise-en-oeuvre-kubernetes"
                  >Kubernetes</a
                >
              </li>
            </ul>
          </div>
        </section>
        <section>
          <h3>√Ä quoi cela peut servir (update) ?</h3>
          <div style="text-align: left">
            <p>Pour configurer son poste de travail</p>
            <ul>
              <li>NoSQL, ROS, Hadoop, serveur web</li>
            </ul>
            <p>Pour une publication</p>
            <ul>
              <li>Image de son exp√©rimentation</li>
              <li>Lien vers l‚Äôimage sur la publication</li>
            </ul>
            <p>D√©ployer des outils pour la recherche</p>
            <ul>
              <li>Faciliter le d√©ploiement et la mise √† jour</li>
              <li>Sharelatex, Redmine, Gitlab, Jenkins, Nexus</li>
            </ul>
          </div>
        </section>
        <section>
          <h3>Les inconv√©nients</h3>
          <div style="text-align: left">
            <p>Eco-syst√®me qui √©volue rapidement (API Deprecated)</p>
            <p>Ne pas √™tre ¬´ allergique ¬ª √† la ligne de commande</p>
            <p>D√©port d‚Äôaffichage (application graphique)</p>
            <p>Limit√© aux syst√®mes Linux</p>
            <p>
              <a href="https://www.docker.com/products/docker-desktop"
                >DockerDesktop</a
              >
              pas un vrai <a href="https://www.docker.com/">Docker</a>
            </p>
            <ul>
              <li>Probl√®me de redirection de ports</li>
              <li>Probl√®me de performance sur les volumes</li>
            </ul>
          </div>
        </section>
        <section>
          <h3>Tips üßπ</h3>
          <div style="text-align: left">
            <p>Supprimer tous les conteneurs arr√™t√©s</p>
            <pre><code class="language-shell" style="font-size: 1em;" data-noescape data-trim>$ docker container prune</code></pre>
            <p>Supprimer les images qui n‚Äôont pas de nom</p>
            <pre><code class="language-shell" style="font-size: 1em;" data-noescape data-trim>$ docker image prune</code></pre>
            <p>Conna√Ætre l‚ÄôIP d‚Äôun conteneur</p>
            <pre><code class="language-shell" style="font-size: 1em;" data-noescape data-trim>$ docker inspect ‚Äìf '{{.NetworkSettings.IPAddress }}' mycont</code></pre>
            <p>S‚Äôattacher √† un conteneur en cours d‚Äôex√©cution</p>
            <pre><code class="language-shell" style="font-size: 1em;" data-noescape data-trim>$ docker attach mycont <=> docker exec ‚Äìit mycont /bin/bash</code></pre>
          </div>
        </section>
        <section>
          <h3>Powered by üôè</h3>
          <div class="container-flex">
            <div class="col-1">
              <a href="https://asciinema.org">
                <img width="60%" src="/images/asciinema.png"
              /></a>
            </div>
            <div class="col-1">
              <a href="https://revealjs.com">
                <img width="60%" src="/images/revealjs.png"
              /></a>
            </div>
          </div>
          <div class="container-flex">
            <div class="col-1">
              <a href="https://jekyllrb.com/">
                <img width="60%" src="/images/jekyll.svg"
              /></a>
            </div>
            <div class="col-1">
              <a href="https://www.docker.com">
                <img width="60%" src="images/dockerlogo.png"
              /></a>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/highlight.min.js"></script>
    <script src="/assets/js/asciinema-player.min.js"></script>
    <script>
      Reveal.initialize({
        hash: true,
        autoPlayMedia: true,
        touch: false,
        slideNumber: "c/t",
        showNotes: false,
        plugins: [RevealHighlight],
      }).then(() => {
        var conf = {
          cols: 130,
          rows: 30,
          theme: "monokai",
          speed: 2,
        };
        AsciinemaPlayer.create(
          "demo/demo1.cast",
          document.getElementById("demo1"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo2.cast",
          document.getElementById("demo2"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo3.cast",
          document.getElementById("demo3"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo4.cast",
          document.getElementById("demo4"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo5.cast",
          document.getElementById("demo5"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo6.cast",
          document.getElementById("demo6"),
          conf
        );
        AsciinemaPlayer.create(
          "demo/demo7.cast",
          document.getElementById("demo7"),
          conf
        );
      });
    </script>
  </body>
</html>
